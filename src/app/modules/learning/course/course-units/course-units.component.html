<div class="flex-col dashboard">
  <mat-card appearance="outlined" *ngFor="let unit of course.knowledgeUnits; let i = index">
    <mat-card-header>
      <mat-icon mat-card-avatar>article</mat-icon>
      <mat-card-title style="text-align: left">{{ unit.name }}</mat-card-title>
      <span style="flex-grow: 1;"></span>
      <mat-icon *ngIf="unit.enrollmentStatus === 'Completed'" class="medal-icon" matTooltip="Lekcija uspešno savladana!" svgIcon="medal"></mat-icon>
      <small *ngIf="unit.bestBefore && unit.enrollmentStatus !== 'Completed'" [ngClass]="{'theme-warn': unit.bestBefore < now}">
        Najbolje završiti do: {{unit.bestBefore | date: 'dd.MM.'}}
      </small>
    </mat-card-header>
    <mat-card-content>
      <p>
        <markdown>{{ unit.goals }}</markdown>
      </p>
    </mat-card-content>
    <mat-card-actions class="mat-row gap">
      <button mat-flat-button 
        [color]="unit.enrollmentStatus !== 'Completed' ? 'primary' : ''" 
        [routerLink]="'units/' + unit.id">
        Pristupi
      </button>
      <span style="flex-grow: 1;"></span>
      <button mat-flat-button (click)="toggleNotes(i)">
        <span *ngIf="!showNotes[i]">Prikaži <mat-icon>assignment</mat-icon></span>
        <span *ngIf="showNotes[i]">Sakrij <mat-icon>assignment</mat-icon></span>
      </button>
    </mat-card-actions>
    
    <!-- Embedded notes section with animation -->
    <div class="notes-container" [@slideInOut]="showNotes[i] ? 'in' : 'out'">
      <cc-embedded-notes *ngIf="notesLoaded[i]" [unitId]="unit.id" [courseId]="unit.courseId"></cc-embedded-notes>
    </div>
  </mat-card>
</div>